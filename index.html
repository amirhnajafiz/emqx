<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Instagram Business Discovery Access Token</title>
</head>
<body>

<form id="appForm">
  <label for="clientId">Client ID:</label>
  <input type="text" id="clientId" name="clientId"><br><br>

  <label for="clientSecret">Client Secret:</label>
  <input type="text" id="clientSecret" name="clientSecret"><br><br>

  <button onclick="loginWithFacebook()">Login with Facebook</button>
</form>

<script>
  function loginWithFacebook() {
    const form = document.getElementById('appForm');
    const clientId = form.elements['clientId'].value;
    const clientSecret = form.elements['clientSecret'].value;
    const redirectUri = window.location.href; // Dynamic redirect URI from current URL
    const scopes = 'instagram_basic,pages_read_engagement'; // Add necessary scopes

    // Open Facebook login dialog
    window.location = `https://www.facebook.com/v13.0/dialog/oauth?client_id=${clientId}&redirect_uri=${redirectUri}&scope=${scopes}`;
  }

  // Function to handle redirect after user authorization
  function handleRedirect() {
    const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get('code');

    if (code) {
      // Use the obtained code to exchange for an access token
      exchangeCodeForToken(code);
    } else {
      // Handle authorization error or redirect to the login page again
      // Redirect to login again or show an error message
      console.error('Authorization error');
    }
  }

  // Function to exchange code for access token
  function exchangeCodeForToken(code) {
    const form = document.getElementById('appForm');
    const clientId = form.elements['clientId'].value;
    const clientSecret = form.elements['clientSecret'].value;
    const redirectUri = window.location.href; // Dynamic redirect URI from current URL

    // Make a POST request to exchange the code for an access token
    fetch(`https://graph.facebook.com/v13.0/oauth/access_token?client_id=${clientId}&client_secret=${clientSecret}&redirect_uri=${redirectUri}&code=${code}`)
      .then(response => response.json())
      .then(data => {
        const accessToken = data.access_token;
        // Use the obtained access token for API calls
        console.log('Access Token:', accessToken);
        // You can now use this token to access Instagram Business Discovery endpoints
      })
      .catch(error => {
        console.error('Error exchanging code for token:', error);
      });
  }

  // Call the function to handle the redirect after authorization
  handleRedirect();
</script>

</body>
</html>
