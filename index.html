<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Instagram Business Discovery Access Token</title>
</head>
<body>

<form id="appForm">
  <label for="clientId">Client ID:</label>
  <input type="text" id="clientId" name="clientId"><br><br>

  <label for="clientSecret">Client Secret:</label>
  <input type="text" id="clientSecret" name="clientSecret"><br><br>

  <button onclick="loginWithFacebook()">Login with Facebook</button>
</form>

<div id="tokenDisplay"></div>

<script>
  function loginWithFacebook() {
    const form = document.getElementById('appForm');
    const clientId = form.elements['clientId'].value;
    const clientSecret = form.elements['clientSecret'].value;
    const redirectUri = window.location.href; // Dynamic redirect URI from current URL
    const scopes = 'instagram_basic,pages_read_engagement'; // Add necessary scopes

    // Open Facebook login dialog
    window.location.href = `https://www.facebook.com/v13.0/dialog/oauth?client_id=${clientId}&redirect_uri=${redirectUri}&scope=${scopes}`;
  }

  // Function to handle redirect after user authorization
  function handleRedirect() {
    const urlParams = new URLSearchParams(window.location.search);
    const authorizationCode = urlParams.get('authorization_code');
    if (authorizationCode) {
      exchangeCodeForToken(authorizationCode);
    } else {
      console.error('Authorization error: No authorization code found');
    }
  }

  // Function to exchange authorization code for access token
  function exchangeCodeForToken(authorizationCode) {
    const form = document.getElementById('appForm');
    const clientId = form.elements['clientId'].value;
    const clientSecret = form.elements['clientSecret'].value;
    const redirectUri = window.location.href; // Dynamic redirect URI from current URL

    // Make a POST request to exchange the authorization code for an access token
    fetch(`https://graph.facebook.com/v13.0/oauth/access_token?client_id=${clientId}&client_secret=${clientSecret}&redirect_uri=${redirectUri}&code=${authorizationCode}`)
      .then(response => response.json())
      .then(data => {
        const accessToken = data.access_token;
        displayAccessToken(accessToken);
      })
      .catch(error => {
        console.error('Error exchanging code for token:', error);
      });
  }

  // Function to display access token
  function displayAccessToken(token) {
    const tokenDisplay = document.getElementById('tokenDisplay');
    tokenDisplay.innerHTML = `<strong>Access Token:</strong> ${token}`;
  }

  // Call the function to handle the redirect after authorization
  handleRedirect();
</script>

</body>
</html>
